<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ancestor Map</title>
    <style type="text/css">
    </style>
  </head>
  <body>

    <center><div id="map_canvas" style="width: 700px; height: 500px; "></div></center>
    <script type="text/javascript" src="https://maps.google.com/maps/api/js?key=AIzaSyAoYQ1svguexT-riNQ9RnK_I4T4_KhrNJA"></script> 
    <!-- <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAoYQ1svguexT-riNQ9RnK_I4T4_KhrNJA&callback=initMap" type="text/javascript"></script> -->
  <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <script src="https://unpkg.com/fs-js-lite@2.x/dist/FamilySearch.min.js"></script>
    <script type="text/javascript">
      var params = getQueryParams();
      var fs = new FamilySearch({ accessToken: params.token, environment: 'production' });
      var map;
      var myOptions = { zoom: 1, center: new google.maps.LatLng(0, 0), mapTypeId: 'terrain' };
      map = new google.maps.Map($('#map_canvas')[0], myOptions);

      // Get locations from FamilySearch
      fs.get('/platform/tree/persons/'+params.pid, function(error, response) {
        var person = response.data.persons[0];
        console.log(person);
        var addresses = [];
        addresses.push(person.display.birthPlace);
        addresses.push(person.display.deathPlace);

        for (var i=0; i<person.facts.length; i++) {
          if (person.facts[i].place) {
            console.log(person.facts[i].place.normalized[0].value)
            addresses.push(person.facts[i].place.normalized[0].value);
          }
        }

        // Geocode locations
        for (var x = 0; x < addresses.length; x++) {
          $.getJSON('https://maps.googleapis.com/maps/api/geocode/json?address='+addresses[x]+'&sensor=false', null, function (data) {
              var p = data.results[0].geometry.location
              var latlng = new google.maps.LatLng(p.lat, p.lng);
              new google.maps.Marker({
                position: latlng,
                map: map
              });
          });
        }
      })

      // Get Query parameters
      function getQueryParams() {
        var vars = [], hash;
        var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
        for(var i = 0; i < hashes.length; i++) {
            hash = hashes[i].split('=');
            vars.push(hash[0]);
            vars[hash[0]] = hash[1];
        }
        return vars;
      }      
    </script>
  </body>
</html>